"use strict";!function(h){var d=[];function v(){h(".notice-skipped").addClass("d-none"),h(".notice-same").addClass("d-none")}function f(e,t,a){var o,s=0<arguments.length&&void 0!==e?e:"",r=1<arguments.length?t:void 0,n=2<arguments.length&&void 0!==a&&a;o=""==s?h(".main-loader"):h("#all-posts-"+s).find(".loader"),"show"==r?o.show():"hide"==r&&o.hide(),n?(o.find(".loader-progress").removeClass("d-none"),o.find(".loader-progress-num").removeClass("d-none")):(o.find(".loader-progress").addClass("d-none"),o.find(".loader-progress-num").addClass("d-none"))}h(document).ready(function(){h(".main-loader").hide(),h(".main-loader .fetching-data").addClass("d-none"),h('[data-toggle="tooltip"]').tooltip(),h(".last-step-import-form, .cpt-exporter, .menus-exporter").on("submit",function(){var e=h(".loader.main-loader");e.find(".fetching-data").addClass("d-none"),e.find(".start-export").removeClass("d-none"),e.show()}),h('input[name="user_mapping_type"]').on("change",function(){!h("#user-mapping-single-author").prop("checked")||h("#user-mapping-single-author-select").val()?h(".last-step-submit").prop("disabled",!1):h(".last-step-submit").prop("disabled",!0)}),h("#user-mapping-single-author-select").on("change",function(){h(this).val()?h(".last-step-submit").prop("disabled",!1):h(".last-step-submit").prop("disabled",!0)}),h(".taxonomy-select-all-checkbox").on("click",function(){var e=h(this).parent("label").prev("select");1==h(this).prop("checked")?e.find("option").prop("selected",!0):e.find("option").prop("selected",!1)}),h(".menu-items-expand-all").on("click",function(){var e="show"==(e=h(this).data("expand"))?"hide":"show";h(this).data("expand",e),h(this).parents(".list-group-item").find(".menu-item-controls").collapse(e)}),h(".menu-items-check-all").on("click",function(){var e=1!=(e=h(this).data("checked"));h(this).data("checked",e),h(this).parents(".list-group-item").find(".menu-item-checkbox").prop("checked",1==e),h(this).parents(".list-group-item").find(".menu-checkbox").prop("checked",1==e)}),h(".menu-item-checkbox").on("change",function(){h(this).prop("checked")&&h(this).parents(".menu-wrapper").find(".menu-checkbox").prop("checked",!0)}),h(".menu-checkbox").on("change",function(){h(this).prop("checked")||h(this).parents(".menu-wrapper").find(".menu-item-checkbox").prop("checked",!1)}),h(document).on("click",".cb-select-all, .cb-select-all-1",function(){var e=h(this).parents(".wp-list-table"),t=h(this).parents(".gpls-all-posts-list-wrapper");e.find(".cb-select-all:checkbox:checked").length?t.find(".add-selected-posts").removeClass("disabled"):t.find(".add-selected-posts").addClass("disabled")}),h(".add-selected-posts").on("click",function(){var l=h(this).data("cpt"),e=h("#all-posts-"+l).find(".wp-list-table");e.find(".cb-select-all:checkbox:checked");d[l]||(d[l]=[]),h.each(e.find(".cb-select-all:checkbox:checked"),function(){var e,t,a,o,s=h(this),r=h(this).parents(".all-posts-list-row"),n=parseInt(h(this).data("id")),i={id:n,title:r.find(".column-title strong").text(),date:r.find(".column-date strong").text()};h(s).prop("checked",!1),h(s).prop("disabled",!0),d[l].includes(n)||(d[l].push(n),t=i,a=h("#selected-posts-"+(e=l)+" table tbody"),o='<tr class="selected-posts-list-row" id="post-selected-'+t.id+'" class="iedit">\n\t\t\t\t<td class="title column-title column-primary page-title">\n\t\t\t\t\t<strong>'+t.title+'</strong>\n\t\t\t\t</td>\n\t\t\t\t<td class="title column-date page-date">\n\t\t\t\t\t<strong>'+t.date+'</strong>\n\t\t\t\t</td>\n\t\t\t\t<td class="actions column-actions column-primary page-action">\n\t\t\t\t\t<button data-id="'+t.id+'" type="button" class="remove-selected-post btn btn-danger" data-cpt="'+e+'">Remove</button>\n\t\t\t\t</td>\n\t\t\t</tr>',a.append(o))}),h(this).addClass("disabled")}),h(document).on("click",".remove-selected-post",function(){var e=parseInt(h(this).data("id")),t=h(this).data("cpt"),a=d[t].indexOf(e);-1<a&&d[t].splice(a,1),h(this).parents(".selected-posts-list-row").remove()}),h(".specific-posts-modal").on("hidden.bs.modal",function(e){var t=h(e.target).data("cpt"),a=h(".cpt_export_specific_posts_"+t);d[t]&&a.val(d[t].join(","))}),h(".import-attachment-zip").on("click",function(){h(".attachment-upload-loader").removeClass("d-none")}),h(".upload-xml-file").on("click",function(){h(".upload-xml-file-loader").removeClass("d-none")}),h(".last-step-submit").on("click",function(e){e.preventDefault(),function a(e){var o=h("input.import-type-val").val();parseInt(h("input.import-total-items").val());var s=parseInt(h("input.import-total-steps").val());var t=h(".import-nonce").val();var r=h(".import-file-id").val();var n=h("input.user-mapping-type:checked").val();var i=[];var l=[];var d=h("#user-mapping-single-author-select").val();var p=h(".importer-wrapper");f("","show",!0);h(".main-loader .loader-text").removeClass("d-none");h("input.imported-authors-select").each(function(){i.push(h(this).val())});h("select.user-map-select").each(function(){var e=h(this).val();0!=e&&l.push(h(this).val())});0==e?(h(".main-loader .first-step-import-xml").removeClass("d-none"),h(".main-loader .rest-step-import-xml").addClass("d-none"),h(".main-loader .loader-progress-num").addClass("d-none")):(h(".main-loader .first-step-import-xml").addClass("d-none"),h(".main-loader .rest-step-import-xml").removeClass("d-none"),h(".main-loader .loader-progress-num").removeClass("d-none"));h.ajax({method:"POST",url:window.gpls_cpt_exporter_importer_localize_data.ajax_url,data:{action:window.gpls_cpt_exporter_importer_localize_data.import_start_action,nonce:t,import_id:r,import_type:o,user_mapping_type:n,user_mapping_single_author_select:d,imported_authors:i,user_map:l,step:e},success:function(e){if(e.success){if(0==e.success)p.empty(),"invalid_nonce"==e.data&&h(".nonce-invalid").removeClass("d-none");else if(null!==e.data.progress){if("end"!==e.data.progress){var t=parseInt(e.data.progress);return h(".main-loader").find(".loader-progress").val(parseInt((t+1)/s*100)),h(".main-loader").find(".loader-progress-num").text(parseInt((t+1)/s*100)+"%"),void a(t+1)}p.empty(),h(".after-submit-notice").removeClass("d-none"),"menu"===o&&h(".menu-import-finish").removeClass("d-none"),h("html, body").animate({scrollTop:0},"slow"),f("","hide")}e.data.errors&&e.data.errors.forEach(function(e){p.append('<div class="alert alert-'+"danger"+'" >'+e+"</div>")})}},error:function(e){console.log("error: ",e),f("","hide"),h(".import-errors-dialog").html(e.responseText).dialog("open")}})}(0)}),h("button.export-xml-file, button.export-zip-file").on("click",function(e){e.preventDefault(),function t(a,o,s){var e=h("#"+window.gpls_cpt_exporter_importer_localize_data.prefix+"-export-nonce").val();var r=[];var n={};var i={};var l={};var d={};var p={};var c={};var m={};h(".cpt-name-checkbox:checked").each(function(){r.push(h(this).val())});h(".cpt-export-type-radio:checked").each(function(){var e=h(this).data("cpt_type"),t=h(this).val();n[e]=t});h(".cpt_export_specific_posts").each(function(){var e=h(this).data("cpt_type"),t=h(this).val();i[e]=t});h(".cpt-terms-select").each(function(){var e=h(this).data("cpt_type"),t=h(this).data("tax_name"),a=h(this).val();null==l[e]&&(l[e]={}),l[e][t]=a});h(".cpt-statuses-select").each(function(){var e=h(this).data("cpt_type"),t=h(this).val();d[e]=t});h(".cpt-authors-select").each(function(){var e=h(this).data("cpt_type"),t=h(this).val();p[e]=t});h(".cpt-start-date-select").each(function(){var e=h(this).data("cpt_type"),t=h(this).val();c[e]=t});h(".cpt-end-date-select").each(function(){var e=h(this).data("cpt_type"),t=h(this).val();m[e]=t});var u={action:window.gpls_cpt_exporter_importer_localize_data.export_start_action,export_type:"cpt",cpt_name:r,cpt_export_type:n,cpt_export_specific_posts:i,cpt_name_terms:l,cpt_statuses:d,cpt_authors:p,cpt_start_date:c,cpt_end_date:m,submit:o,step:a};u[window.gpls_cpt_exporter_importer_localize_data.prefix+"-export-nonce"]=e;u[window.gpls_cpt_exporter_importer_localize_data.prefix+"-export-submit"]=1;v();"xml"===s?(f("","show",!0),h(".main-loader .start-export-xml").removeClass("d-none"),h(".main-loader .first-step-export-xml").removeClass("d-none"),h(".main-loader .rest-step-export-xml").addClass("d-none"),h(".main-loader .start-export-zip").addClass("d-none")):(f("","show"),h(".main-loader .start-export-zip").removeClass("d-none"),h(".main-loader .start-export-xml").addClass("d-none"));0==a?(h(".main-loader .loader-progress").val(0),h(".main-loader .loader-progress-num").text("0%"),h(".main-loader .loader-progress-num").addClass("d-none"),h(".main-loader .first-step-export-xml").removeClass("d-none"),h(".main-loader .rest-step-export-xml").addClass("d-none")):(h(".main-loader .first-step-export-xml").addClass("d-none"),h(".main-loader .rest-step-export-xml").removeClass("d-none"),h(".main-loader .loader-progress-num").removeClass("d-none"));h.ajax({method:"POST",url:window.gpls_cpt_exporter_importer_localize_data.ajax_url,data:u,success:function(e){if(0!=e.success)return"end"!=e.data.progress?(h(".main-loader .loader-progress").val(parseInt(e.data.progress)),h(".main-loader .loader-progress-num").text(parseInt(e.data.progress)+"%"),h(".main-loader .first-step-export-xml").addClass("d-none"),h(".main-loader .rest-step-export-xml").removeClass("d-none"),void t(a+5,o,s)):(h(".main-loader .loader-progress").val(100),h(".main-loader .loader-progress-num").text("100%"),window.location.href=e.data.download_link,void setTimeout(function(){f("","hide")},8e3));h(".export-errors-dialog").html(e.data).dialog("open"),f("","hide")},error:function(e){console.log("error: ",e),f("","hide"),h(".export-errors-dialog").html(e.responseText).dialog("open")}})}(0,h(this).val(),h(this).data("cpt_type"))}),h(".export-errors-dialog").dialog({autoOpen:!1})})}(jQuery);